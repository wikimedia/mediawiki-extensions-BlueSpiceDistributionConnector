<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:wf="http://hallowelt.com/schema/bpmn/wf" id="Definitions_1scr31p" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="8.7.2">
  <bpmn:process id="Process_Three_Step_Approval" isExecutable="false">
    <bpmn:extensionElements>
      <wf:context>
        <wf:contextItem name="pageId" />
        <wf:contextItem name="revision" />
      </wf:context>
    </bpmn:extensionElements>
    <bpmn:startEvent id="TheStart">
      <bpmn:outgoing>FromTheStartToCollectData</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="FromTheStartToCollectData" sourceRef="TheStart" targetRef="CollectData" />
    <bpmn:userTask id="CollectData" name="CollectData">
      <bpmn:extensionElements>
            <wf:type>custom_form</wf:type>
			<wf:formModule>
				<wf:module>ext.bluespice.distributionconnector.workflows.forms</wf:module>
				<wf:class>bs.distributionConnector.workflows.form.ThreeStepApprovalCollectData</wf:class>
			</wf:formModule>
            <wf:initializer>true</wf:initializer>
        </bpmn:extensionElements>
      <bpmn:incoming>FromTheStartToCollectData</bpmn:incoming>
      <bpmn:outgoing>FromCollectDataToGroupVote</bpmn:outgoing>
      <bpmn:property name="groupname" />
      <bpmn:property name="instructionsGroup" />
      <bpmn:property name="usernameExpert" />
      <bpmn:property name="instructionsExpert" />
      <bpmn:property name="usernameHead" />
      <bpmn:property name="instructionsHead" />
      <bpmn:property name="reportrecipient" />
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromCollectDataToGroupVote" sourceRef="CollectData" targetRef="GroupVote" />
    <bpmn:userTask id="GroupVote" name="Groupvote">
		<bpmn:extensionElements>
            <wf:type>group_vote</wf:type>
        </bpmn:extensionElements>

        <bpmn:property name="assigned_group">{{{CollectData.groupname}}}</bpmn:property>
        <bpmn:property name="instructions">{{{CollectData.instructionsGroup}}}</bpmn:property>
        <bpmn:property name="comment"></bpmn:property>
        <bpmn:property name="users_voted"></bpmn:property>
        <bpmn:property name="vote_summary"></bpmn:property>
        <bpmn:property name="vote"></bpmn:property>

		<bpmn:incoming>FromCollectDataToGroupVote</bpmn:incoming>
		<bpmn:outgoing>FromGroupVoteToGatewayGroupVote</bpmn:outgoing>
        <bpmn:standardLoopCharacteristics />
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromGroupVoteToGatewayGroupVote" sourceRef="GroupVote" targetRef="GatewayGroupVote" />
    <bpmn:exclusiveGateway id="GatewayGroupVote" name="GroupVote.vote">
      <bpmn:incoming>FromGroupVoteToGatewayGroupVote</bpmn:incoming>
      <bpmn:outgoing>FromGatewayGroupVoteToUserVoteExpert</bpmn:outgoing>
      <bpmn:outgoing>FromGatewayGroupVoteToTheEnd</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="FromGatewayGroupVoteToUserVoteExpert" name="yes" sourceRef="GatewayGroupVote" targetRef="UserVoteExpert" />
    <bpmn:userTask id="UserVoteExpert" name="UserVote">
		<bpmn:extensionElements>
        <wf:type>user_vote</wf:type>
      </bpmn:extensionElements>

      <bpmn:property name="instructions">{{{CollectData.instructionsExpert}}}</bpmn:property>
	  <bpmn:property name="vote"></bpmn:property>
	  <bpmn:property name="comment"></bpmn:property>
	  <bpmn:property name="delegate_to"></bpmn:property>
	  <bpmn:property name="delegate_comment"></bpmn:property>
	  <!-- Hidden -->
	  <bpmn:property name="assigned_user">{{{CollectData.usernameExpert}}}</bpmn:property>
	  <bpmn:property name="action"></bpmn:property>
	  <bpmn:incoming>FromGatewayGroupVoteToUserVoteExpert</bpmn:incoming>
      <bpmn:outgoing>FromUserVoteExpertToGatewayExpert</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromUserVoteExpertToGatewayExpert" sourceRef="UserVoteExpert" targetRef="GatewayExpert" />
    <bpmn:exclusiveGateway id="GatewayExpert" name="UserVoteExpert.vote">
      <bpmn:incoming>FromUserVoteExpertToGatewayExpert</bpmn:incoming>
      <bpmn:outgoing>FromGatewayExpertToUserVoteHead</bpmn:outgoing>
      <bpmn:outgoing>FromGatewayExpertToTheEnd</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="FromGatewayExpertToUserVoteHead" name="yes" sourceRef="GatewayExpert" targetRef="UserVoteHead" />
    <bpmn:userTask id="UserVoteHead" name="UserVote">
		<bpmn:extensionElements>
		<wf:type>user_vote</wf:type>
	  </bpmn:extensionElements>

	  <bpmn:property name="instructions">{{{CollectData.instructionsHead}}}</bpmn:property>
	  <bpmn:property name="vote"></bpmn:property>
	  <bpmn:property name="comment"></bpmn:property>
	  <bpmn:property name="delegate_to"></bpmn:property>
	  <bpmn:property name="delegate_comment"></bpmn:property>
	  <!-- Hidden -->
	  <bpmn:property name="assigned_user">{{{CollectData.usernameHead}}}</bpmn:property>
	  <bpmn:property name="action"></bpmn:property>

	  <bpmn:incoming>FromGatewayExpertToUserVoteHead</bpmn:incoming>
      <bpmn:outgoing>FromUserVoteHeadToGatewayHead</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromUserVoteHeadToGatewayHead" sourceRef="UserVoteHead" targetRef="GatewayHead" />
    <bpmn:exclusiveGateway id="GatewayHead" name="UserVoteHead.vote">
      <bpmn:incoming>FromUserVoteHeadToGatewayHead</bpmn:incoming>
      <bpmn:outgoing>FromGatewayHeadToApproveRevision</bpmn:outgoing>
      <bpmn:outgoing>FromGatewayHeadToTheEnd</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="FromGatewayHeadToApproveRevision" name="yes" sourceRef="GatewayHead" targetRef="ApproveRevision" />
    <bpmn:sequenceFlow id="FromGatewayHeadToTheEnd" name="no" sourceRef="GatewayHead" targetRef="TheEnd" />
    <bpmn:task id="ApproveRevision" name="ApproveRevision">
      <bpmn:extensionElements>
        <wf:type>approve_revision</wf:type>
      </bpmn:extensionElements>
      <bpmn:incoming>FromGatewayHeadToApproveRevision</bpmn:incoming>
      <bpmn:outgoing>FromApproveRevisionToSendMail</bpmn:outgoing>
      <bpmn:property name="comment" default="{{{UserVoteHead.username}}}: {{{UserVoteHead.comment}}}" />
    </bpmn:task>
    <bpmn:sequenceFlow id="FromApproveRevisionToSendMail" sourceRef="ApproveRevision" targetRef="SendMail" />
    <bpmn:task id="SendMail" name="SendMail">
      <bpmn:extensionElements>
        <wf:type>send_mail</wf:type>
      </bpmn:extensionElements>
      <bpmn:incoming>FromApproveRevisionToSendMail</bpmn:incoming>
      <bpmn:outgoing>FromSendMailToTheEnd</bpmn:outgoing>
      <bpmn:property name="recipient" default="{{{CollectData.reportrecipient}}}"/>
		<bpmn:property name="subject" default="{{int:workflow-default-three-step-approval-report-subject}}"/>
		<bpmn:property name="body" default="{{int:workflow-default-approval-report-body|
		        *{{{GroupVote.groupname}}} (Group): {{{GroupVote.comment}}}
		        *{{{UserVoteExpert.usernameExpert}}} (Expert): {{{UserVoteExpert.comment}}}
		        *{{{UserVoteHead.usernameHead}}} (Head): {{{UserVoteHead.comment}}}}}" />
    </bpmn:task>
    <bpmn:sequenceFlow id="FromSendMailToTheEnd" sourceRef="SendMail" targetRef="TheEnd" />
    <bpmn:endEvent id="TheEnd">
      <bpmn:incoming>FromSendMailToTheEnd</bpmn:incoming>
      <bpmn:incoming>FromGatewayHeadToTheEnd</bpmn:incoming>
      <bpmn:incoming>FromGatewayGroupVoteToTheEnd</bpmn:incoming>
      <bpmn:incoming>FromGatewayExpertToTheEnd</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="FromGatewayGroupVoteToTheEnd" name="no" sourceRef="GatewayGroupVote" targetRef="TheEnd" />
    <bpmn:sequenceFlow id="FromGatewayExpertToTheEnd" name="no" sourceRef="GatewayExpert" targetRef="TheEnd" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_Three_Step_Approval">
      <bpmndi:BPMNEdge id="FromSendMailToTheEnd_di" bpmnElement="FromSendMailToTheEnd">
        <di:waypoint x="1450" y="120" />
        <di:waypoint x="1512" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromApproveRevisionToSendMail_di" bpmnElement="FromApproveRevisionToSendMail">
        <di:waypoint x="1290" y="120" />
        <di:waypoint x="1350" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayHeadToTheEnd_di" bpmnElement="FromGatewayHeadToTheEnd">
        <di:waypoint x="1110" y="145" />
        <di:waypoint x="1110" y="240" />
        <di:waypoint x="1530" y="240" />
        <di:waypoint x="1530" y="138" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1312" y="222" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayHeadToApproveRevision_di" bpmnElement="FromGatewayHeadToApproveRevision">
        <di:waypoint x="1135" y="120" />
        <di:waypoint x="1190" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1152" y="102" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromUserVoteHeadToGatewayHead_di" bpmnElement="FromUserVoteHeadToGatewayHead">
        <di:waypoint x="1030" y="120" />
        <di:waypoint x="1085" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayExpertToTheEnd_di" bpmnElement="FromGatewayExpertToTheEnd">
        <di:waypoint x="850" y="145" />
        <di:waypoint x="850" y="270" />
        <di:waypoint x="1530" y="270" />
        <di:waypoint x="1530" y="138" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1182" y="252" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayExpertToUserVoteHead_di" bpmnElement="FromGatewayExpertToUserVoteHead">
        <di:waypoint x="875" y="120" />
        <di:waypoint x="930" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="892" y="102" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromUserVoteExpertToGatewayExpert_di" bpmnElement="FromUserVoteExpertToGatewayExpert">
        <di:waypoint x="770" y="120" />
        <di:waypoint x="825" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayGroupVoteToTheEnd_di" bpmnElement="FromGatewayGroupVoteToTheEnd">
        <di:waypoint x="570" y="145" />
        <di:waypoint x="570" y="320" />
        <di:waypoint x="1530" y="320" />
        <di:waypoint x="1530" y="138" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1042" y="302" width="17" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGatewayGroupVoteToUserVoteExpert_di" bpmnElement="FromGatewayGroupVoteToUserVoteExpert">
        <di:waypoint x="595" y="120" />
        <di:waypoint x="670" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="622" y="102" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromGroupVoteToGatewayGroupVote_di" bpmnElement="FromGroupVoteToGatewayGroupVote">
        <di:waypoint x="500" y="120" />
        <di:waypoint x="545" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromCollectDataToGroupVote_di" bpmnElement="FromCollectDataToGroupVote">
        <di:waypoint x="340" y="120" />
        <di:waypoint x="400" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="FromTheStartToCollectData_di" bpmnElement="FromTheStartToCollectData">
        <di:waypoint x="188" y="120" />
        <di:waypoint x="240" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="TheStart">
        <dc:Bounds x="152" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="CollectData_di" bpmnElement="CollectData">
        <dc:Bounds x="240" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0oa11ft_di" bpmnElement="GroupVote">
        <dc:Bounds x="400" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="GatewayGroupVote_di" bpmnElement="GatewayGroupVote" isMarkerVisible="true">
        <dc:Bounds x="545" y="95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="532" y="145" width="77" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0f1a8u7_di" bpmnElement="UserVoteExpert">
        <dc:Bounds x="670" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="GatewayExpert_di" bpmnElement="GatewayExpert" isMarkerVisible="true">
        <dc:Bounds x="825" y="95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="807" y="145" width="86" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_01lu472_di" bpmnElement="UserVoteHead">
        <dc:Bounds x="930" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="GatewayHead_di" bpmnElement="GatewayHead" isMarkerVisible="true">
        <dc:Bounds x="1085" y="95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1067" y="145" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ApproveRevision_di" bpmnElement="ApproveRevision">
        <dc:Bounds x="1190" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SendMail_di" bpmnElement="SendMail">
        <dc:Bounds x="1350" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TheEnd_di" bpmnElement="TheEnd">
        <dc:Bounds x="1512" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>