<?xml version="1.0" encoding="UTF-8"?>

<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wf="http://hallowelt.com/schema/bpmn/wf" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_0pa0etv" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="8.7.1">

<!-- Process part -->
<bpmn:process id="Process_Four_Eyes_Principle" isExecutable="false">
    <bpmn:extensionElements>
		<wf:context>
			<wf:contextItem name="pageId"/>
			<wf:contextItem name="revision"/>
		</wf:context>
	</bpmn:extensionElements>

    <!-- StartEvent -->
    <bpmn:startEvent id="TheStart">
        <bpmn:outgoing>FromTheStartToCollectData</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="FromTheStartToCollectData" sourceRef="TheStart" targetRef="CollectData" />

    <!-- CollectData -->
    <bpmn:userTask id="CollectData" name="Collect Data">
         <bpmn:extensionElements>
            <wf:type>custom_form</wf:type>
            <wf:formModule>
				<wf:module>ext.bluespice.distributionconnector.workflows.forms</wf:module>
				<wf:class>bs.distributionConnector.workflows.form.FourEyesPrincipleCollectData</wf:class>
			</wf:formModule>
            <wf:initializer>true</wf:initializer>
        </bpmn:extensionElements>

        <bpmn:property name="usernameExpert"></bpmn:property>
        <bpmn:property name="instructionsExpert"></bpmn:property>

        <bpmn:property name="usernameHead"></bpmn:property>
        <bpmn:property name="instructionsHead"></bpmn:property>

        <bpmn:property name="reportrecipient"></bpmn:property>

        <bpmn:incoming>FromTheStartToCollectData</bpmn:incoming>
        <bpmn:outgoing>FromCollectDataToUserVoteExpert</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromCollectDataToUserVoteExpert" sourceRef="CollectData" targetRef="UserVoteExpert" />

    <!-- Ask the expert -->
    <bpmn:userTask id="UserVoteExpert" name="UserVote">
        <bpmn:extensionElements>
            <wf:type>custom_form</wf:type>
            <wf:formModule>
				<wf:module>ext.bluespice.distributionconnector.workflows.forms</wf:module>
				<wf:class>bs.distributionConnector.workflows.form.Feedback</wf:class>
			</wf:formModule>
        </bpmn:extensionElements>

        <bpmn:property name="instructions" default="{{{CollectData.instructionsExpert}}}" />
		<bpmn:property name="comment"></bpmn:property>
		<!-- Hidden -->
		<bpmn:property name="assigned_user" default="{{{CollectData.usernameExpert}}}" />

        <bpmn:incoming>FromCollectDataToUserVoteExpert</bpmn:incoming>
        <bpmn:outgoing>FromUserVoteExpertToUserVoteHead</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromUserVoteExpertToUserVoteHead" sourceRef="UserVoteExpert" targetRef="UserVoteHead" />

    <!-- Ask the boss -->
    <bpmn:userTask id="UserVoteHead" name="UserVote">
         <bpmn:extensionElements>
			 <wf:type>custom_form</wf:type>
			 <wf:formModule>
				<wf:module>ext.bluespice.distributionconnector.workflows.forms</wf:module>
				<wf:class>bs.distributionConnector.workflows.form.Feedback</wf:class>
			</wf:formModule>
		 </bpmn:extensionElements>

		<bpmn:property name="instructions" default="{{{CollectData.instructionsHead}}}" />
		<bpmn:property name="comment"></bpmn:property>
		<!-- Hidden -->
		<bpmn:property name="assigned_user" default="{{{CollectData.usernameHead}}}" />

        <bpmn:incoming>FromUserVoteExpertToUserVoteHead</bpmn:incoming>
        <bpmn:outgoing>FromUserVoteHeadToSendMail</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="FromUserVoteHeadToSendMail" sourceRef="UserVoteHead" targetRef="SendMail" />

    <!-- Send mail -->
    <bpmn:task id="SendMail" name="Send Mail">
         <bpmn:extensionElements>
            <wf:type>send_mail</wf:type>
        </bpmn:extensionElements>

        <bpmn:property name="recipient">{{{CollectData.reportrecipient}}}</bpmn:property>
        <bpmn:property name="subject">{{int:workflow-default-feedback-four-eyes-principle-report-subject|}}</bpmn:property>
        <bpmn:property name="body">{{int:workflow-default-feedback-four-eyes-principle-review-report-body|
            * {{{UserVoteExpert.username}}} (Expert): {{{UserVoteExpert.comment}}}
            * {{{UserVoteHead.username}}} (Head): {{{UserVoteHead.comment}}}}}
        </bpmn:property>

        <bpmn:incoming>FromUserVoteHeadToSendMail</bpmn:incoming>
        <bpmn:outgoing>FromSendMailToTheEnd</bpmn:outgoing>
    </bpmn:task>
    <bpmn:sequenceFlow id="FromSendMailToTheEnd" sourceRef="SendMail" targetRef="TheEnd" />

    <!-- EndEvent -->
    <bpmn:endEvent id="TheEnd">
        <bpmn:incoming>FromSendMailToTheEnd</bpmn:incoming>
    </bpmn:endEvent>

</bpmn:process>

<!-- Visual part -->
<bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_19f606g">

        <bpmndi:BPMNEdge id="FromUserVoteHeadToSendMail_di" bpmnElement="FromUserVoteHeadToSendMail">
            <di:waypoint x="660" y="120" />
            <di:waypoint x="770" y="120" />
        </bpmndi:BPMNEdge>

        <bpmndi:BPMNEdge id="FromUserVoteExpertToUserVoteHead_di" bpmnElement="FromUserVoteExpertToUserVoteHead">
            <di:waypoint x="480" y="120" />
            <di:waypoint x="560" y="120" />
        </bpmndi:BPMNEdge>

        <bpmndi:BPMNEdge id="FromSendMailToTheEnd_di" bpmnElement="FromSendMailToTheEnd">
            <di:waypoint x="870" y="120" />
            <di:waypoint x="952" y="120" />
        </bpmndi:BPMNEdge>

        <bpmndi:BPMNEdge id="FromCollectDataToUserVoteExpert_di" bpmnElement="FromCollectDataToUserVoteExpert">
            <di:waypoint x="310" y="120" />
            <di:waypoint x="380" y="120" />
        </bpmndi:BPMNEdge>

        <bpmndi:BPMNEdge id="FromTheStartToCollectData_di" bpmnElement="FromTheStartToCollectData">
            <di:waypoint x="158" y="120" />
            <di:waypoint x="210" y="120" />
        </bpmndi:BPMNEdge>

        <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="TheStart">
            <dc:Bounds x="122" y="102" width="36" height="36" />
        </bpmndi:BPMNShape>

        <bpmndi:BPMNShape id="CollectData_di" bpmnElement="CollectData">
            <dc:Bounds x="210" y="80" width="100" height="80" />
        </bpmndi:BPMNShape>

        <bpmndi:BPMNShape id="UserVoteExpert_di" bpmnElement="UserVoteExpert">
            <dc:Bounds x="380" y="80" width="100" height="80" />
        </bpmndi:BPMNShape>

        <bpmndi:BPMNShape id="UserVoteHead_di" bpmnElement="UserVoteHead">
            <dc:Bounds x="560" y="80" width="100" height="80" />
        </bpmndi:BPMNShape>

        <bpmndi:BPMNShape id="SendMail_di" bpmnElement="SendMail">
            <dc:Bounds x="770" y="80" width="100" height="80" />
        </bpmndi:BPMNShape>

        <bpmndi:BPMNShape id="TheEnd_di" bpmnElement="TheEnd">
            <dc:Bounds x="952" y="102" width="36" height="36" />
        </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
</bpmndi:BPMNDiagram>
</bpmn:definitions>
